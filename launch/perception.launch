<launch>
  <arg name="video_device" default="false" /> <!--Use video device online-->
  <arg name="perspective" default="dockingstation" /> <!--None, camera or dockingstation-->
  <arg name="publish_path" default="true" /> <!--if true, perspective has to be given-->
  <arg name="sim" default="false" /> <!-- When running simulation, some topic needs to be remapped-->
  <arg name="hz" default="15"/>
  <arg name="pose_feedback" default="true"/>
  <arg name="rviz" default="false"/>
  <arg name="sam" default="true"/>

  <!--Some parameters for the perception node-->
  <arg name="feature_model_yaml" default="docking_station_2.yaml" />
  <arg name="hats_mode" default="valley" /> <!--peak, valley or simple-->
  <arg name="camera_info_topic" default="camera_info" /> 
  <arg name="image_processed_topic" default="perception/image_processed" /> 
  <arg name="image_processed_drawing_topic" default="perception/image_processed_drawing" /> 
  <arg name="image_pose_topic" default="perception/image_pose" /> 
  <arg name="estimated_pose_topic" default="perception/estimated_pose" /> 
  <arg name="camera_pose_topic" default="perception/camera_pose" /> 
  <arg name="estimated_camera_pose_topic" default="perception/estimated_camera_pose" /> 
  <arg name="estimated_poses_array_topic" default="perception/estimated_poses_array" /> 
  <arg name="estimation_error_topic" default="perception/estimation_error" /> 
  
  <group ns="/sam/payload/cam_forward/">
    <node name="perception_node" pkg="sam_perception" type="perception_node.py" output="screen" >
      <param name="feature_model_yaml" value="$(arg feature_model_yaml)"/>
      <param name="hz" value="$(arg hz)"/>
      <param name="publish_cam_pose" value="$(eval arg('perspective') == 'dockingstation')"/>
      <param name="hats_mode" value="$(arg hats_mode)"/>
      <param name="pose_feedback" value="$(arg pose_feedback)"/>

      <param name="camera_info_topic" value="$(arg camera_info_topic)"/>
      <param name="camera_pose_topic" value="$(arg camera_pose_topic)"/>
      <param name="image_processed_topic" value="$(arg image_processed_topic)"/>
      <param name="image_processed_drawing_topic" value="$(arg image_processed_drawing_topic)"/>
      <param name="image_pose_topic" value="$(arg image_pose_topic)"/>
      <param name="estimated_pose_topic" value="$(arg estimated_pose_topic)"/>
      <param name="camera_pose_topic" value="$(arg camera_pose_topic)"/>
      <param name="estimated_camera_pose_topic" value="$(arg estimated_camera_pose_topic)"/>
      <param name="estimated_poses_array_topic" value="$(arg estimated_poses_array_topic)"/>
      <param name="estimation_error_topic" value="$(arg estimation_error_topic)"/>

      <param name="image_topic" value="/sam/payload/cam_forward/image_decompressed"/>
      <param name="camera_frame" value="sam/camera_front_link"/>
      <remap from="camera_info" to="/sam/payload/cam_forward/camera_info"/>
      <remap from="$(arg estimated_pose_topic)" to="/sam/perception/estimated_pose"/>

    </node>
  </group>

  <group ns="/sam/payload/cam_port/">
    <node name="perception_node" pkg="sam_perception" type="perception_node.py" output="screen" >
      <param name="feature_model_yaml" value="$(arg feature_model_yaml)"/>
      <param name="hz" value="$(arg hz)"/>
      <param name="publish_cam_pose" value="$(eval arg('perspective') == 'dockingstation')"/>
      <param name="hats_mode" value="$(arg hats_mode)"/>
      <param name="pose_feedback" value="$(arg pose_feedback)"/>

      <param name="camera_info_topic" value="$(arg camera_info_topic)"/>
      <param name="camera_pose_topic" value="$(arg camera_pose_topic)"/>
      <param name="image_processed_topic" value="$(arg image_processed_topic)"/>
      <param name="image_processed_drawing_topic" value="$(arg image_processed_drawing_topic)"/>
      <param name="image_pose_topic" value="$(arg image_pose_topic)"/>
      <param name="estimated_pose_topic" value="$(arg estimated_pose_topic)"/>
      <param name="camera_pose_topic" value="$(arg camera_pose_topic)"/>
      <param name="estimated_camera_pose_topic" value="$(arg estimated_camera_pose_topic)"/>
      <param name="estimated_poses_array_topic" value="$(arg estimated_poses_array_topic)"/>
      <param name="estimation_error_topic" value="$(arg estimation_error_topic)"/>

      <param name="image_topic" value="/sam/payload/cam_port/image_decompressed"/>
      <param name="camera_frame" value="sam/camera_front_left_link"/>
      <remap from="camera_info" to="/sam/payload/cam_port/camera_info"/>
      <remap from="$(arg estimated_pose_topic)" to="/sam/perception/estimated_pose"/>

    </node>
  </group>

  <group ns="/sam/payload/cam_starboard/">
    <node name="perception_node" pkg="sam_perception" type="perception_node.py" output="screen" >
      <param name="feature_model_yaml" value="$(arg feature_model_yaml)"/>
      <param name="hz" value="$(arg hz)"/>
      <param name="publish_cam_pose" value="$(eval arg('perspective') == 'dockingstation')"/>
      <param name="hats_mode" value="$(arg hats_mode)"/>
      <param name="pose_feedback" value="$(arg pose_feedback)"/>

      <param name="camera_info_topic" value="$(arg camera_info_topic)"/>
      <param name="camera_pose_topic" value="$(arg camera_pose_topic)"/>
      <param name="image_processed_topic" value="$(arg image_processed_topic)"/>
      <param name="image_processed_drawing_topic" value="$(arg image_processed_drawing_topic)"/>
      <param name="image_pose_topic" value="$(arg image_pose_topic)"/>
      <param name="estimated_pose_topic" value="$(arg estimated_pose_topic)"/>
      <param name="camera_pose_topic" value="$(arg camera_pose_topic)"/>
      <param name="estimated_camera_pose_topic" value="$(arg estimated_camera_pose_topic)"/>
      <param name="estimated_poses_array_topic" value="$(arg estimated_poses_array_topic)"/>
      <param name="estimation_error_topic" value="$(arg estimation_error_topic)"/>

      <param name="image_topic" value="/sam/payload/cam_starboard/image_decompressed"/>
      <param name="camera_frame" value="sam/camera_front_right_link"/>
      <remap from="camera_info" to="/sam/payload/cam_starboard/camera_info"/>
      <remap from="$(arg estimated_pose_topic)" to="/sam/perception/estimated_pose"/>

    </node>
  </group>

  <!-- TODO: What does this node do? -->
  <node pkg="sam_perception" type="path_publisher_node.py" name="path_publisher_node" if="$(eval arg('publish_path') == true)">
    <remap from="/pose_topic" to="/docking_station_pose" if="$(eval arg('perspective') == 'camera')"/>
    <remap from="/pose_topic" to="/sam_camera/estimated_pose" if="$(eval arg('perspective') == 'dockingstation')"/>
  </node>

  <node type="rviz" name="rviz" pkg="rviz" args="-d $(find sam_perception)/rviz/sam.rviz" if="$(arg rviz)"/>

</launch>
